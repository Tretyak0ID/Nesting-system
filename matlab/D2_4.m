function [D2]=D2_4(n,b)
% optimizdd solution
Db5 = .7572547503753819696617548765192041577064d0;
Db6 = -.2137262481230901516912826929382111115051d0;
c32 = 0.d0;c33 = 0.d0;
c34 = 3.537514766710830037910752698007451731610d0;
c41 = 0.d0;c42 = 0.d0;c43 = 0.d0;
c44 = 0.7385501622485695586677787025911214676886d-2;
d325 = 32.51048471738421604519286254254722933186d0;
d326 = -7.620858146195750192324493816504335027386d0;
d335 = -13.88777502260632966138966870205827213699d0;
d336 = 3.468933822141331092700263415569337869041d0;
d345 = -0.7823237972910208591778157593262697095161d-2;
d346 = .1374085563591570998874444470862136095142d0;
d416 = 4.229344891548268383217258212685349574041d0;
d426 = 9.579016877423331087022080485160204772741d0;
d436 = 23.25697672941185239293966264033611499384d0;
d446 = 146.1284822111720230230691538908767591180d0;
% optimum family of solutions
c31 = 1030347.d0/286552.d0-c32-c33-c34; d315=(34.d0*(675.d0+8428.d0*d325*c32+8428.d0*d335*c33+8428.d0*d345*c34))/...
(-1030347.d0+286552.d0*c32+286552.d0*c33+286552.d0*c34);
d316 = (1462.d0*(196.d0*d326*c32+196.d0*d336*c33+196.d0*d346*c34-87.d0))/...
(-1030347.d0+286552.d0*c32+286552.d0*c33+286552.d0*c34);
% solution to Db
Db1 = -11.d0/6.d0+Db5+4.d0*Db6; Db2 = 3.d0-4.d0*Db5-15.d0*Db6;
Db3 = -3.d0/2.d0+6.d0*Db5+20.d0*Db6; Db4 = 1.d0/3.d0-4.d0*Db5-10.d0*Db6;
% construct D3
d311 = -1.d0+d315+4.d0*d316;d312 = 3.d0-4.d0*d315-15.d0*d316;
d313 = -3.d0+6.d0*d315+20.d0*d316;d314 = 1.d0-4.d0*d315-10.d0*d316; d321 = -1.d0+d325+4.d0*d326;d322 = 3.d0-4.d0*d325-15.d0*d326;
d323 = -3.d0+6.d0*d325+20.d0*d326;d324 = 1.d0-4.d0*d325-10.d0*d326; d331 = -1.d0+d335+4.d0*d336;d332 = 3.d0-4.d0*d335-15.d0*d336;
d333 = -3.d0+6.d0*d335+20.d0*d336;d334 = 1.d0-4.d0*d335-10.d0*d336; d341 = -1.d0+d345+4.d0*d346;d342 = 3.d0-4.d0*d345-15.d0*d346;
d343 = -3.d0+6.d0*d345+20.d0*d346;d344 = 1.d0-4.d0*d345-10.d0*d346;
% construct D4
d411 = 1.d0-d416;d412 = -4.d0+5.d0*d416;d413 = 6.d0-10.d0*d416;
d414 = -4.d0+10.d0*d416;d415 = 1.d0-5.d0*d416;d421 = 1.d0-d426;
d422 = 5.d0*d426-4.d0;d423 = 6.d0-10.d0*d426;d424 = -4.d0+10.d0*d426; d425 = 1.d0-5.d0*d426;d431 = 1.d0-d436;d432 = -4.d0+5.d0*d436;
d433 = 6.d0-10.d0*d436;d434 = -4.d0+10.d0*d436;d435 = 1.d0-5.d0*d436; d441 = 1.d0-d446;d442 = -4.d0+5.d0*d446;d443 = 6.d0-10.d0*d446;
d444 = 10.d0*d446-4.d0;d445 = 1.d0-5.d0*d446;

M11 = zeros(1,4);
M11(1) = 0.12d2 / 0.17d2 + d311 ^ 2 * c31 / 0.18d2 + d411 ^ 2 * c41 / 0.48d2;
M11(2) = 0.59d2 / 0.192d3 + d321 ^ 2 * c32 / 0.18d2 + d421 ^ 2 * c42 / 0.48d2; 
M11(3) = 0.1d1 / 0.129d3 + d331 ^ 2 * c33 / 0.18d2 + d431 ^ 2 * c43 / 0.48d2; 
M11(4) = 0.3d1 / 0.3136d4 + d341 ^ 2 * c34 / 0.18d2 + d441^2 * c44 / 0.48d2;

M12 = zeros(1,4);
M12(1) = -0.59d2 / 0.68d2 + d311 * c31 * d312 / 0.18d2 + d411 * c41 * d412 / 0.48d2;
M12(2) = d321 * c32 * d322 / 0.18d2 + d421 * c42 * d422 / 0.48d2;
M12(3) = -0.59d2 / 0.1032d4 + d331 * c33 * d332 / 0.18d2 + d431 * c43 * d432 / 0.48d2;
M12(4) = d341 * c34 * d342 / 0.18d2 + d441 * c44 * d442 / 0.48d2;

M13 = zeros(1,4);
M13(1) = 0.2d1 / 0.17d2 + d311 * c31 * d313 / 0.18d2 + d411 * c41 * d413 / 0.48d2;
M13(2) = -0.59d2 / 0.192d3 + d321 * c32 * d323 / 0.18d2 + d421 * c42 * d423 / 0.48d2;
M13(3) = d331 * c33 * d333 / 0.18d2 + d431 * c43 * d433 / 0.48d2;
M13(4) = -0.59d2 / 0.3136d4 + d341 * c34 * d343 / 0.18d2 + d441 * c44 * d443 / 0.48d2;

M14 = zeros(1,4);
M14(1) = 0.3d1 / 0.68d2 + d311 * c31 * d314 / 0.18d2 + d411 * c41 * d414 / 0.48d2;
M14(2) = d321 * c32 * d324 / 0.18d2 + d421 * c42 * d424 / 0.48d2;
M14(3) = 0.59d2 / 0.1032d4 + d331 * c33 * d334 / 0.18d2 + d431 * c43 * d434 / 0.48d2;
M14(4) = d341 * c34 * d344 / 0.18d2 + d441 * c44 * d444 / 0.48d2;

M15 = zeros(1,4);
M15(1) = d311 * c31 * d315 / 0.18d2 + d411 * c41 * d415 / 0.48d2;
M15(2) = d321 * c32 * d325 / 0.18d2 + d421 * c42 * d425 / 0.48d2;
M15(3) = -0.1d1 / 0.129d3 + d331 * c33 * d335 / 0.18d2 + d431 * c43 * d435 / 0.48d2;
M15(4) = 0.1d1 / 0.49d2 + d341 * c34 * d345 / 0.18d2 + d441 * c44 * d445 / 0.48d2;

M16 = zeros(1,4);
M16(1) = d311 * c31 * d316 / 0.18d2 + d411 * c41 * d416 / 0.48d2; 
M16(2) = d321 * c32 * d326 / 0.18d2 + d421 * c42 * d426 / 0.48d2; 
M16(3) = d331 * c33 * d336 / 0.18d2 + d431 * c43 * d436 / 0.48d2;
M16(4) = -0.1d1 /0.392d3 + d341 * c34 * d346 / 0.18d2 + d441 * c44 * d446 / 0.48d2;

M22 = zeros(1,4); 
M22(1) = 0.3481d4 / 0.3264d4 + d312 ^ 2 * c31 / 0.18d2 + d412 ^ 2 * c41 / 0.48d2;
M22(2) = d322 ^ 2 * c32 / 0.18d2 + d422 ^ 2 * c42 / 0.48d2;
M22(3) = 0.3481d4 / 0.8256d4 + d332 ^ 2 * c33 / 0.18d2 + d432 ^ 2 * c43 / 0.48d2;
M22(4) = d342 ^ 2 * c34 / 0.18d2 + d442 ^ 2 * c44 / 0.48d2;

M23 = zeros(1,4);
M23(1) = -0.59d2 / 0.408d3 + d312 * c31 * d313 / 0.18d2 + d412 * c41 * d413 / 0.48d2;
M23(2) = d322 * c32 * d323 / 0.18d2 + d422 * c42 * d423 / 0.48d2; 
M23(3) = d332 * c33 * d333 / 0.18d2 + d432 * c43 * d433 / 0.48d2; 
M23(4) = d342 * c34 * d343 / 0.18d2 + d442 * c44 * d443 / 0.48d2;

M24 = zeros(1,4);
M24(1) = -0.59d2 / 0.1088d4 + d312 * c31 * d314 / 0.18d2 + d412 * c41 * d414 / 0.48d2;
M24(2) = d322 * c32 * d324 / 0.18d2 + d422 * c42 * d424 / 0.48d2;
M24(3) = -0.3481d4 / 0.8256d4 + d332 * c33 * d334 / 0.18d2 + d432 * c43 * d434 / 0.48d2;
M24(4) = d342 * c34 * d344 / 0.18d2 + d442 * c44 * d444 / 0.48d2;

M25 = zeros(1,4);
M25(1) = d312 * c31 * d315 / 0.18d2 + d412 * c41 * d415 / 0.48d2;
M25(2) = d322 * c32 * d325 / 0.18d2 + d422 * c42 * d425 / 0.48d2;
M25(3) = 0.59d2 / 0.1032d4 + d332 * c33 * d335 / 0.18d2 + d432 * c43 * d435 / 0.48d2;
M25(4) = d342 * c34 * d345 / 0.18d2 + d442 * c44 * d445 / 0.48d2;

M26 = zeros(1,4);
M26(1) = d312 * c31 * d316 / 0.18d2 + d412 * c41 * d416 / 0.48d2; 
M26(2) = d322 * c32 * d326 / 0.18d2 + d422 * c42 * d426 / 0.48d2; 
M26(3) = d332 * c33 * d336 / 0.18d2 + d432 * c43 * d436 / 0.48d2; 
M26(4) = d342 * c34 * d346 / 0.18d2 + d442 * c44 * d446 / 0.48d2;

M33 = zeros(1,5);
M33(1) = 0.1d1 / 0.51d2 + d313 ^ 2 * c31 / 0.18d2 + d413 ^ 2 * c41 / 0.48d2;
M33(2) = 0.59d2 / 0.192d3 + d323 ^ 2 * c32 / 0.18d2 + d423 ^ 2 * c42 / 0.48d2;
M33(3) = d333 ^ 2 * c33 / 0.18d2 + d433 ^ 2 * c43 / 0.48d2;
M33(4) = 0.3481d4 / 0.9408d4 + d343 ^ 2 * c34 / 0.18d2 + d443 ^ 2 * c44 / 0.48d2;
M33(5) = 0.1d1 / 0.24d2;

M34 = zeros(1,5);
M34(1) = 0.1d1 / 0.136d3 + d313 * c31 * d314 / 0.18d2 + d413 * c41 * d414 / 0.48d2; 
M34(2) = d323 * c32 * d324 / 0.18d2 + d423 * c42 * d424 / 0.48d2;
M34(3) = d333 * c33 * d334 / 0.18d2 + d433 * c43 * d434 / 0.48d2;
M34(4) = d343 * c34 * d344 / 0.18d2 + d443 * c44 * d444 / 0.48d2;
M34(5) = -0.1d1 / 0.6d1;

M35 = zeros(1,5);
M35(1) = d313 * c31 * d315 / 0.18d2 + d413 * c41 * d415 / 0.48d2;
M35(2) = d323 * c32 * d325 / 0.18d2 + d423 * c42 * d425 / 0.48d2;
M35(3) = d333 * c33 * d335 / 0.18d2 + d433 * c43 * d435 / 0.48d2;
M35(4) = -0.59d2 / 0.147d3 + d343 * c34 * d345 / 0.18d2 + d443 * c44 * d445 / 0.48d2;
M35(5) = 0.1d1 / 0.8d1;

M36 = zeros(1,5);
M36(1) = d313 * c31 * d316 / 0.18d2 + d413 * c41 * d416 / 0.48d2; 
M36(2) = d323 * c32 * d326 / 0.18d2 + d423 * c42 * d426 / 0.48d2; 
M36(3) = d333 * c33 * d336 / 0.18d2 + d433 * c43 * d436 / 0.48d2;
M36(4) = 0.59d2 / 0.1176d4 + d343 * c34 * d346 / 0.18d2 + d443 * c44 * d446 / 0.48d2;

M44 = zeros(1,6); 
M44(1) = 0.3d1 / 0.1088d4 + d314 ^ 2 * c31 / 0.18d2 + d414 ^ 2 * c41 / 0.48d2;
M44(2) = d324 ^ 2 * c32 / 0.18d2 + d424 ^ 2 * c42 / 0.48d2;
M44(3) = 0.3481d4 / 0.8256d4 + d334 ^ 2 * c33 / 0.18d2 + d434 ^ 2 * c43 / 0.48d2;
M44(4) = d344 ^ 2 * c34 / 0.18d2 + d444 ^ 2 * c44 / 0.48d2;
M44(5) = 0.5d1 / 0.6d1;
M44(6) = 0.1d1 / 0.24d2;

M45 = zeros(1,6);
M45(1) = d314 * c31 * d315 / 0.18d2 + d414 * c41 * d415 / 0.48d2; 
M45(2) = d324 * c32 * d325 / 0.18d2 + d424 * c42 * d425 / 0.48d2; 
M45(3) = -0.59d2 / 0.1032d4 + d334 * c33 * d335 / 0.18d2 + d434 * c43 * d435 / 0.48d2;
M45(4) = d344 * c34 * d345 / 0.18d2 + d444 * c44 * d445 / 0.48d2; 
M45(5) = -0.1d1 / 0.2d1;
M45(6) = -0.1d1 / 0.6d1;

M46 = zeros(1,6);
M46(1) = d314 * c31 * d316 / 0.18d2 + d414 * c41 * d416 / 0.48d2; 
M46(2) = d324 * c32 * d326 / 0.18d2 + d424 * c42 * d426 / 0.48d2; 
M46(3) = d334 * c33 * d336 / 0.18d2 + d434 * c43 * d436 / 0.48d2; 
M46(4) = d344 * c34 * d346 / 0.18d2 + d444 * c44 * d446 / 0.48d2;
M46(5) = -0.1d1 / 0.6d1;M46(6) = 0.1d1 / 0.8d1;

M55 = zeros(1,7);
M55(1) = d315 ^ 2 * c31 / 0.18d2 + d415 ^ 2 * c41 / 0.48d2;
M55(2) = d325 ^ 2 * c32 / 0.18d2 + d425 ^ 2 * c42 / 0.48d2;
M55(3) = 0.1d1 / 0.129d3 + d335 ^ 2 * c33 / 0.18d2 + d435 ^ 2 * c43 / 0.48d2; 
M55(4) = 0.64d2 / 0.147d3 + d345 ^ 2 * c34 / 0.18d2 + d445 ^ 2 * c44 / 0.48d2; 
M55(5) = 0.3d1 / 0.4d1;
M55(6) = 0.5d1 / 0.6d1;
M55(7) = 0.1d1 / 0.24d2;

M56 = zeros(1,7);
M56(1) = d315 * c31 * d316 / 0.18d2 + d415 * c41 * d416 / 0.48d2; 
M56(2) = d325 * c32 * d326 / 0.18d2 + d425 * c42 * d426 / 0.48d2; 
M56(3) = d335 * c33 * d336 / 0.18d2 + d435 * c43 * d436 / 0.48d2;
M56(4) = -0.8d1 / 0.147d3 + d345 * c34 * d346 / 0.18d2 + d445 * c44 * d446 / 0.48d2;
M56(5) = -0.1d1 / 0.2d1;
M56(6) = -0.1d1 / 0.2d1;
M56(7) = -0.1d1 / 0.6d1;

M66 = zeros(1,8);
M66(1) = d316 ^ 2 * c31 / 0.18d2 + d416 ^ 2 * c41 / 0.48d2;
M66(2) = d326 ^ 2 * c32 / 0.18d2 + d426 ^ 2 * c42 / 0.48d2;
M66(3) = d336 ^ 2 * c33 / 0.18d2 + d436 ^ 2 * c43 / 0.48d2;
M66(4) = 0.1d1 / 0.147d3 + d346 ^ 2 * c34 / 0.18d2 + d446 ^ 2 * c44 / 0.48d2; 
M66(5) = 0.5d1 / 0.6d1;
M66(6) = 0.3d1 / 0.4d1;
M66(7) = 0.5d1 / 0.6d1;
M66(8) = 0.1d1 / 0.24d2;

Mjm2 = zeros(1,5);
Mjm2(1) = 0.1D1 / 0.8D1;
Mjm2(2) = -0.1D1 / 0.6D1;
Mjm2(3) = 0.1D1 / 0.8D1;
Mjm2(4) = 0.d0;
Mjm2(5) = 0.d0;

Mjm1 = zeros(1,5);
Mjm1(1) = -0.1D1 / 0.6D1;
Mjm1(2) = -0.1D1 / 0.2D1;
Mjm1(3) = -0.1D1 / 0.2D1; 
Mjm1(4) = -0.1D1 / 0.6D1;
Mjm1(5) = 0.d0;

Mj = zeros(1,5);
Mj(1) = 0.1D1 / 0.24D2;
Mj(2) = 0.5D1 / 0.6D1;
Mj(3) = 0.3D1 / 0.4D1; 
Mj(4) = 0.5D1 / 0.6D1;
Mj(5) = 0.1D1 / 0.24D2;

Mjp1 = zeros(1,5);
Mjp1(1) = 0.d0;
Mjp1(2) = -0.1D1 / 0.6D1;
Mjp1(3) = -0.1D1 / 0.2D1; 
Mjp1(4) = -0.1D1 / 0.2D1;
Mjp1(5) = -0.1D1 / 0.6D1;

Mjp2 = zeros(1,5);
Mjp2(1) = 0.d0;
Mjp2(2) = 0.d0;
Mjp2(3) = 0.1D1 / 0.8D1; 
Mjp2(4) = -0.1D1 / 0.6D1;
Mjp2(5) = 0.1D1 / 0.8D1;

H11 = 17.d0/48.d0; 
H22 = 59.d0/48.d0; 
H33 = 43.d0/48.d0; 
H44 = 49.d0/48.d0;
%sdtting up H
H = eye(n,n);
H(1,1) = H11;
H(n,n) = H11;
H(2,2) = H22;
H(n-1,n-1) = H22; 
H(3,3) = H33;
H(n-2,n-2) = H33;
H(4,4) = H44;
H(n-3,n-3) = H44;

M = zeros(n,n);
Db = zeros(n,n);
Db(1,1:6) = b(1)*[Db1,Db2,Db3,Db4,Db5,Db6]; 
Db(n,n:-1:n-5) = -b(n)*[Db1,Db2,Db3,Db4,Db5,Db6];
E = zeros(n,n);
E(1,1) = -1;
E(n,n) = 1;

M(1,1:6) = [M11*b(1:4),M12*b(1:4),M13*b(1:4),M14*b(1:4),M15*b(1:4),M16*b(1:4)]; 
M(2,1:6) = [M12*b(1:4),M22*b(1:4),M23*b(1:4),M24*b(1:4),M25*b(1:4),M26*b(1:4)]; 
M(3,1:6) = [M13*b(1:4),M23*b(1:4),M33*b(1:5),M34*b(1:5),M35*b(1:5),M36*b(1:5)]; 
M(4,1:6) = [M14*b(1:4),M24*b(1:4),M34*b(1:5),M44*b(1:6),M45*b(1:6),M46*b(1:6)]; 
M(5,1:7) = [M15*b(1:4),M25*b(1:4),M35*b(1:5),M45*b(1:6),M55*b(1:7),M56*b(1:7), Mjp2*b(5-2:5+2)];
M(6,1:8) = [M16*b(1:4),M26*b(1:4),M36*b(1:5),M46*b(1:6),M56*b(1:7),M66*b(1:8), Mjp1*b(6-2:6+2),Mjp2*b(6-2:6+2)];

%intdrnal rows
for i = 7:n-6 
    M(i,i-2:i+2) = [Mjm2*b(i-2:i+2),Mjm1*b(i-2:i+2),Mj*b(i-2:i+2),Mjp1*b(i-2:i+2),Mjp2*b(i-2:i+2)];
end

M(n-5,n:-1:n-7) = [M16*b(n:-1:n-3),M26*b(n:-1:n-3),M36*b(n:-1:n-4),M46*b(n:-1:n-5),M56*b(n:-1:n-6), M66*b(n:-1:n-7),Mjm1*b((n-5)-2:(n-5)+2),Mjm2*b((n-5)-2:(n-5)+2)]; 
M(n-4,n:-1:n-6) = [M15*b(n:-1:n-3),M25*b(n:-1:n-3),M35*b(n:-1:n-4),M45*b(n:-1:n-5),M55*b(n:-1:n-6), M56*b(n:-1:n-6),Mjm2*b((n-4)-2:(n-4)+2)];
M(n-3,n:-1:n-5) = [M14*b(n:-1:n-3),M24*b(n:-1:n-3),M34*b(n:-1:n-4),M44*b(n:-1:n-5),M45*b(n:-1:n-5), M46*b(n:-1:n-5)]; 
M(n-2,n:-1:n-5) = [M13*b(n:-1:n-3),M23*b(n:-1:n-3),M33*b(n:-1:n-4),M34*b(n:-1:n-4),M35*b(n:-1:n-4), M36*b(n:-1:n-4)];
M(n-1,n:-1:n-5) = [M12*b(n:-1:n-3),M22*b(n:-1:n-3),M23*b(n:-1:n-3),M24*b(n:-1:n-3),M25*b(n:-1:n-3), M26*b(n:-1:n-3)]; 
M(n,n:-1:n-5) = [M11*b(n:-1:n-3),M12*b(n:-1:n-3),M13*b(n:-1:n-3),M14*b(n:-1:n-3),M15*b(n:-1:n-3), M16*b(n:-1:n-3)];

D2 = inv(H)*(-M+E*Db);
end
